---
title: 操作系统
date: 2024-07-29 09:12:26
tags: 听课笔记
---
# 操作系统概述

## 操作系统的概念、功能

**操作系统**(Operating System,OS)是指{%label 控制 green%} 和{%label 管理 green%} 整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源的分配: 以提供给用户和其他软件方便的{%label 接口和环境 green%} ；它是计算机系统中最基本的{%label 系统软件 green%} 。

- 系统资源的管理者
  - 提供的功能
    - 处理机管理
    - 存储器管理
    - 文件管理
    - 设备管理
  - 目标： 安全，高效
- 向上层提供方便易用的服务
  - 图形用户接口(Graphical User Interface,GUI)
  - 联机命令接口
  - 脱机命令接口(批处理命令接口)
  - 程序接口：可以在程序中进行{%label 系统调用 green%}来使用程序接口。普通用户不能直接使用程序接口，只能通过程序代码{%label 间接 green%} 使用。 
- 最接近硬件的一层软件
  - 扩充机器

## 操作系统的特征

**并发**(最基本)：两个或多个事件在同一时间间隔内发生。这些事情{%label 宏观上是同时发生的 green%}，但{%label 微观上是交替发生的 green%}  

- {%label 操作系统的并发性 green%}指计算机系统中“同时”运行着多个程序，这些程序宏观上看是同时运行着的，而微观上是交替运行着的。
- {%label 单核CPU green%}同一时刻只能执行一个程序，各个程序只能{%label 并发 green%}执行
- {%label 多核CPU green%}同一时刻可以执行多个程序，各个程序只能{%label 并发 green%}执行

> **并行**：两个或多个事件在同一时刻同时发生。

**共享**(最基本)：即资源共享，指操作系统中的资源可供内存中多个并发执行的进程共同使用。

- 互斥共享方式
- 同时共享方式(并发)

>并发和共享互为存在条件

**虚拟**:把物理上的实体变为若干个逻辑上的对应物。物理实体是实际存在的，而逻辑上对应物(后者)是用户感受到的。

- 空分复用技术(如虚拟存储器技术)
- 时分复用技术(如虚拟处理器)

**异步**：在多道程序环境下，允许多个进程并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。

## 操作系统的发展与分类

**手工操作阶段**

使用纸带机，输入输出慢

主要缺点： 用户独占全机，人机速度矛盾导致资源利用率极低

**批处理阶段：单道批处理系统**

引入脱机输入/输出技术，并由{%label 监督程序 green%}负责控制作业的输入输出

**批处理阶段：多道批处理系统**

- 主要优点：多道程序并发执行，共享计算机资源。资源利用率大幅提升,CPU和其他资源更能保持忙碌的状态，系统吞吐量增大。
- 主要缺点：用户响应时间长，{%label 没有人机交互功能 red%}

**分时操作系统**

计算机以{%label 时间片 red%}为单位轮流为各个用户/作业服务，各个用户可通过终端与计算机进行交互。

- 主要优点：用户请求可以被即时响应，{%label 解决了人机交互问题 green%}，允许多个用户同时使用一台计算机，并且用户对计算机的操作相互独立，感受不到别人的存在。

- 主要缺点：{%label 不能优先处理一些紧急任务 red%}。操作系统对各个用户/作业都是完全公平的，循环地为每个用户/作业服务一个时间片，不区分任务的紧急性

**实时操作系统**

在实时操作系统的控制下，计算机系统接收到外部信号后及时进行处理，并且要在{%label 严格的时限内处理完事件 green%}。实时操作系统的主要特点是{%label 及时性和可靠性 green%}

**网络操作系统**

**分布式操作系统**

**个人计算机操作系统**

## 操作系统的运行机制

**操作系统内核(Kernel)**:内核是操作系统最重要最核心的部分，也是最接近硬件的部分。

>**程序状态寄存器(PSW)**
>
>1表示“内核态"，0表示"用户态"
>
>- 内核态=核心态=管态：可以执行特权指令
>- 用户态=目态：只能执行非特权指令

**内核态，用户态的切换**

- 内核态->用户态:执行一条{%label 特权指令 green%}--修改PSW的标志位为用户态，这个动作意味着操作系统将主动让出CPU使用权。
- 用户态->内核态:由{%label 中断 red%}引发，硬件自动完成变态过程，触发中断信号意味着操作系统将强行夺回CPU的使用权。

## 中断和异常

**中断的作用**

CPU上会运行两种程序，一种是{%label 操作系统内核程序 green%},一种是{%label 应用程序 green%}

**中断的类型**

- 内中断(异常，例外)：与当前执行的指令{%label 有关 green%},中断信号来源于CPU的{%label 内部 green%}
  - 试图在用户态下执行特权指令
  - 执行除法指令时发现除数为0
  - 应用程序想要请求操作系统内核的服务，此时会执行一条特殊的指令--{%label 陷入指令 green%},该指令会引发一个内部中断信号
  - 分类
    - 陷阱，陷入(trap)
    - 故障(fault)
    - 终止(abort)
- 外中断：与当前执行的指令{%label 无关 green%},中断信号来源于CPU的{%label 外部 green%}
  - 时钟中断：由时钟部件发来的中断信号，每隔50ms发一个
  - I/O中断：由输入输出设备发来的中断信号

**中断机制的基本原理**

不同的中断信号，需要用不同的中断处理程序来处理。当CPU检测到中断信号后，会根据中断信号的类型去查询{%label 中断向量表 green%} ,以此来找到相应的中断处理程序在内存中的存放位置。

## 系统调用

**什么是系统调用**

操作系统提供给应用程序(程序员/编程人员)使用的接口，可以理解为一种可供应用程序调用的特殊函数，{%label 应用程序可以通过系统调用来请求获得操作系统内核的服务 green%}

**系统调用分类**

- 设备管理：完成设备的 请求/释放/启动 等功能
- 文件管理： 完成文件的 读/写/创建/删除 等功能
- 进程控制： 完成进程的 创建/撤销/阻塞/唤醒 等功能
- 进程通信： 完成进程之间的消息传递/信号传递等功能
- 内存管理： 完成内存的 分配/回收 等功能

## 操作系统的体系结构

**大内核**:进程管理，存储管理，设备管理也运行在内核态

- 优点：高性能
- 缺点：内核代码庞大，结构混乱，难以维护

**小内核**：只有时钟管理，中断处理，原语等运行在内核态

- 优点：内核功能少，结构清晰，方便维护
- 缺点：需要频繁地在核心态和用户态之间切换，性能低

|                 | 特性，思想                                                   | 优点                                                         | 缺点                                                         |
| --------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 分层结构        | 内核分多层，每层只可调用更低一层提供的接口                   | 便于调试和验证，自底向上逐层调试验证；易扩充和易维护，各层之间调用接口清晰固定 | 仅可调用相邻低层，难以合理定义各层的边界；效率低，不可跨层调用，系统调用执行时间长 |
| 模块化          | 将内核划分为多个模块，各模块之间相互协作；内核=主模块+可加载内核模块；主模块：只负责核心功能，如进程调度，内存管理；可加载模块：可以动态加载新模块到内核，而无需重新编译整个内核。 | 模块间逻辑清晰易于维护，确定模块间接口后即可多模块同时开发；支持动态加载新的内核模块，增强OS适应性。任何模块都可以直接调用其他模块，无需采用消息传递进行通信，效率高。 | 模块间的接口定义未必合理，实用；模块间相互依赖，更难以调试和验证 |
| 宏内核(大内核)  | 所有的系统功能都放在内核里面(大内核结构的OS通常也采用了模块化的设计思想) | 性能高，内核内部各种功能都可以直接相互调用                   | 内核庞大功能复杂，难以维护；大内核中某个功能模块出错，就可能导致整个系统崩溃 |
| 微内核          | 只把中断，原语，进程通信等最核心的功能放入内核。进程管理，文件管理，设备管理等功能以用户进程的形式在用户态运行 | 内核小功能少易于维护，内核可靠性高；内核外某个功能模块出错不会导致整个系统崩溃 | 性能低，需要频繁地切换用户态和内核态；用户态下各功能模块不可以直接相互调用，只能通过内核的消息传递来间接通信 |
| 外核(exokernel) | 内核负责进程调度，进程通信等功能，外核负责为用户进程分配未经抽象的硬件资源，且由外核负责保证资源使用安全 | 外核可直接给用户进程分配不虚拟，不抽象的硬件资源，使用户进程可以更灵活地使用硬件资源；减少了使用虚拟硬件资源的映射层，提升效率 | 降低了系统的一致性；使系统变得更复杂                         |

## 操作系统引导(Boot)

**主引导记录(MBR)**:

- 磁盘引导程序
- 分区表

**步骤**

1. CPU从一个特定主存地址开始，取指令，执行ROM中的引导程序(先进行硬件自检，再开机)
2. 将磁盘的第一块--主引导记录读入内存，执行磁盘引导程序，扫描分区表
3. 从活动分区(又称为主分区，即安装了操作系统的分区)读入分区引导记录，执行其中的程序
4. 从根目录下找到完整的操作系统初始化程序(即 启动管理器)并执行，完成"开机"的一系列动作
